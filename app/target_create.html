<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Creatw Target</title>
    <link rel="stylesheet" href="flex.css" />
  </head>
  <body>
    <header><h1>Set Target</h1></header>
    <main>
      <section>
        <div class="back-btn"><a href="dashboard.html">Back</a></div>
        <form id="createTarget">
          <fieldset>
            <label for="cTarget">Target</label>
            <textarea
              name="Target"
              id="cTarget"
              placeholder="Set Your Target"
              required
            ></textarea>
            <label for="artht">Target Price</label>
            <input
              type="number"
              id="artht"
              placeholder="amount_required_to_hit_target"
              required
            />
            <label for="dtt">Target Day</label>
            <input
              type="number"
              id="dtt"
              placeholder="days_to_target"
              required
            />
            <label for="mi">Earnings</label>
            <input
              type="number"
              id="mi"
              placeholder="monthly_income"
              required
            />
            <label for="as">Savings</label>
            <input
              type="number"
              id="as"
              placeholder="amount_saved (leave blank if you have no savings yet)"
            />
            <button type="submit" id="tBtn">submit</button>
          </fieldset>
        </form>
        <div id="message" class="hidden"></div>
      </section>
    </main>
    <footer>
      <p>Â© 2025 AOT</p>
    </footer>
    <script>
      const token = localStorage.getItem("access_token");
      if (!token) {
        alert("invalid access");
      }
      const createTarget = document.getElementById("createTarget");
      createTarget.addEventListener("submit", async (e) => {
        e.preventDefault();
        try {
          const data = {
            target: document.getElementById("cTarget").value,
            amount_required_to_hit_target: parseFloat(
              document.getElementById("artht").value
            ),
            days_to_target: parseFloat(document.getElementById("dtt").value),
            monthly_income: parseFloat(document.getElementById("mi").value),
            amount_saved: parseFloat(document.getElementById("as").value) || 0,
          };
          const res = await fetch("http://localhost:8000/plot/create", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(data),
          });
          function message(text, type = "info") {
            const show = document.getElementById("message");
            show.textContent = text;
            show.className = "message";
            show.classList.add(type);
            show.classList.remove("hidden");
          }
          if (res.ok) {
            message(
              "Target created successfully, now its time to hit the target!",
              "success"
            );
            createTarget.reset();
          } else {
            const result = await res.json();
            message("Could not set target, please try again", "error");
            console.error(result);
          }
        } catch (err) {
          message("Network error, please try again", "error");
        }
      });
    </script>
  </body>
</html>
